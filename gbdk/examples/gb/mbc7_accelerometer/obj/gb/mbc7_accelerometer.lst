                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler
                                      3 ; Version 4.5.1 #15267 (Mac OS X ppc)
                                      4 ;--------------------------------------------------------
                                      5 	.module mbc7_accelerometer
                                      6 	
                                      7 ;--------------------------------------------------------
                                      8 ; Public variables in this module
                                      9 ;--------------------------------------------------------
                                     10 	.globl _mbc7_accel_update
                                     11 	.globl _mbc7_accel_setorigin
                                     12 	.globl _mbc7_accel_init
                                     13 	.globl _mbc7_accel_read
                                     14 	.globl _delay
                                     15 	.globl _accel_y_relative
                                     16 	.globl _accel_x_relative
                                     17 	.globl _accel_y_origin
                                     18 	.globl _accel_x_origin
                                     19 	.globl _accel_origin_set
                                     20 	.globl _accel_y
                                     21 	.globl _accel_x
                                     22 ;--------------------------------------------------------
                                     23 ; special function registers
                                     24 ;--------------------------------------------------------
                                     25 ;--------------------------------------------------------
                                     26 ; ram data
                                     27 ;--------------------------------------------------------
                                     28 	.area _DATA
    00000000                         29 _accel_x::
    00000000                         30 	.ds 2
    00000002                         31 _accel_y::
    00000002                         32 	.ds 2
                                     33 ;--------------------------------------------------------
                                     34 ; ram data
                                     35 ;--------------------------------------------------------
                                     36 	.area _INITIALIZED
    00000000                         37 _accel_origin_set::
    00000000                         38 	.ds 1
    00000001                         39 _accel_x_origin::
    00000001                         40 	.ds 2
    00000003                         41 _accel_y_origin::
    00000003                         42 	.ds 2
    00000005                         43 _accel_x_relative::
    00000005                         44 	.ds 2
    00000007                         45 _accel_y_relative::
    00000007                         46 	.ds 2
                                     47 ;--------------------------------------------------------
                                     48 ; absolute external ram data
                                     49 ;--------------------------------------------------------
                                     50 	.area _DABS (ABS)
                                     51 ;--------------------------------------------------------
                                     52 ; global & static initialisations
                                     53 ;--------------------------------------------------------
                                     54 	.area _HOME
                                     55 	.area _GSINIT
                                     56 	.area _GSFINAL
                                     57 	.area _GSINIT
                                     58 ;--------------------------------------------------------
                                     59 ; Home
                                     60 ;--------------------------------------------------------
                                     61 	.area _HOME
                                     62 	.area _HOME
                                     63 ;--------------------------------------------------------
                                     64 ; code
                                     65 ;--------------------------------------------------------
                                     66 	.area _CODE
                                     67 ;src/mbc7_accelerometer.c:70: void mbc7_accel_read(void) {
                                     68 ;	---------------------------------
                                     69 ; Function mbc7_accel_read
                                     70 ; ---------------------------------
    00000000                         71 _mbc7_accel_read::
                                     72 ;src/mbc7_accelerometer.c:72: accel_x = ((uint16_t)(rMBC7_ACCEL_X_HI) << 8) | (uint16_t)rMBC7_ACCEL_X_LO;
    00000000 FAr00r00         [16]   73 	ld	a, (_rMBC7_ACCEL_X_HI)
    00000003 47               [ 4]   74 	ld	b, a
    00000004 FAr00r00         [16]   75 	ld	a, (_rMBC7_ACCEL_X_LO)
    00000007 EAr00r00         [16]   76 	ld	(_accel_x), a
    0000000A 78               [ 4]   77 	ld	a, b
    0000000B EAr01r00         [16]   78 	ld	(_accel_x + 1), a
                                     79 ;src/mbc7_accelerometer.c:73: accel_y = ((uint16_t)(rMBC7_ACCEL_Y_HI) << 8) | (uint16_t)rMBC7_ACCEL_Y_LO;
    0000000E FAr00r00         [16]   80 	ld	a, (_rMBC7_ACCEL_Y_HI)
    00000011 47               [ 4]   81 	ld	b, a
    00000012 FAr00r00         [16]   82 	ld	a, (_rMBC7_ACCEL_Y_LO)
    00000015 EAr02r00         [16]   83 	ld	(_accel_y), a
    00000018 78               [ 4]   84 	ld	a, b
    00000019 EAr03r00         [16]   85 	ld	(_accel_y + 1), a
                                     86 ;src/mbc7_accelerometer.c:79: rMBC7_LATCH_1 = MBC7_LATCH_ERASE;
    0000001C 21r00r00         [12]   87 	ld	hl, #_rMBC7_LATCH_1
    0000001F 36 55            [12]   88 	ld	(hl), #0x55
                                     89 ;src/mbc7_accelerometer.c:80: rMBC7_LATCH_2 = MBC7_LATCH_CAPTURE;
    00000021 21r00r00         [12]   90 	ld	hl, #_rMBC7_LATCH_2
    00000024 36 AA            [12]   91 	ld	(hl), #0xaa
                                     92 ;src/mbc7_accelerometer.c:81: }
    00000026 C9               [16]   93 	ret
                                     94 ;src/mbc7_accelerometer.c:84: void mbc7_accel_init(void) {
                                     95 ;	---------------------------------
                                     96 ; Function mbc7_accel_init
                                     97 ; ---------------------------------
    00000027                         98 _mbc7_accel_init::
                                     99 ;src/mbc7_accelerometer.c:87: rMBC7_SRAM_ENABLE_1 = MBC7_SRAM_ENABLE_KEY_1;
    00000027 21r00r00         [12]  100 	ld	hl, #_rMBC7_SRAM_ENABLE_1
    0000002A 36 0A            [12]  101 	ld	(hl), #0x0a
                                    102 ;src/mbc7_accelerometer.c:88: rMBC7_SRAM_ENABLE_2 = MBC7_SRAM_ENABLE_KEY_2;
    0000002C 21r00r00         [12]  103 	ld	hl, #_rMBC7_SRAM_ENABLE_2
    0000002F 36 40            [12]  104 	ld	(hl), #0x40
                                    105 ;src/mbc7_accelerometer.c:91: mbc7_accel_read();
    00000031 CDr00r00         [24]  106 	call	_mbc7_accel_read
                                    107 ;src/mbc7_accelerometer.c:95: delay(2);
    00000034 11 02 00         [12]  108 	ld	de, #0x0002
                                    109 ;src/mbc7_accelerometer.c:96: }
    00000037 C3r00r00         [16]  110 	jp	_delay
                                    111 ;src/mbc7_accelerometer.c:99: void mbc7_accel_setorigin(void) {
                                    112 ;	---------------------------------
                                    113 ; Function mbc7_accel_setorigin
                                    114 ; ---------------------------------
    0000003A                        115 _mbc7_accel_setorigin::
                                    116 ;src/mbc7_accelerometer.c:100: accel_x_origin = accel_x;
    0000003A FAr00r00         [16]  117 	ld	a, (#_accel_x)
    0000003D EAr01r00         [16]  118 	ld	(#_accel_x_origin),a
    00000040 FAr01r00         [16]  119 	ld	a, (#_accel_x + 1)
    00000043 EAr02r00         [16]  120 	ld	(#_accel_x_origin + 1),a
                                    121 ;src/mbc7_accelerometer.c:101: accel_y_origin = accel_y;
    00000046 FAr02r00         [16]  122 	ld	a, (#_accel_y)
    00000049 EAr03r00         [16]  123 	ld	(#_accel_y_origin),a
    0000004C FAr03r00         [16]  124 	ld	a, (#_accel_y + 1)
    0000004F EAr04r00         [16]  125 	ld	(#_accel_y_origin + 1),a
                                    126 ;src/mbc7_accelerometer.c:102: accel_origin_set = true;
    00000052 21r00r00         [12]  127 	ld	hl, #_accel_origin_set
    00000055 36 01            [12]  128 	ld	(hl), #0x01
                                    129 ;src/mbc7_accelerometer.c:103: }
    00000057 C9               [16]  130 	ret
                                    131 ;src/mbc7_accelerometer.c:106: void mbc7_accel_update(bool do_set_origin) {
                                    132 ;	---------------------------------
                                    133 ; Function mbc7_accel_update
                                    134 ; ---------------------------------
    00000058                        135 _mbc7_accel_update::
    00000058 4F               [ 4]  136 	ld	c, a
                                    137 ;src/mbc7_accelerometer.c:108: mbc7_accel_read();
    00000059 C5               [16]  138 	push	bc
    0000005A CDr00r00         [24]  139 	call	_mbc7_accel_read
    0000005D C1               [12]  140 	pop	bc
                                    141 ;src/mbc7_accelerometer.c:110: if (do_set_origin) {
    0000005E CB 41            [ 8]  142 	bit	0, c
    00000060 28 03            [12]  143 	jr	Z, 00102$
                                    144 ;src/mbc7_accelerometer.c:111: mbc7_accel_setorigin();
    00000062 CDr3Ar00         [24]  145 	call	_mbc7_accel_setorigin
    00000065                        146 00102$:
                                    147 ;src/mbc7_accelerometer.c:114: if (accel_origin_set) {
    00000065 21r00r00         [12]  148 	ld	hl, #_accel_origin_set
    00000068 CB 46            [12]  149 	bit	0, (hl)
    0000006A C8               [20]  150 	ret	Z
                                    151 ;src/mbc7_accelerometer.c:116: accel_x_relative = (int16_t)(accel_x_origin - accel_x);
    0000006B FAr01r00         [16]  152 	ld	a, (#_accel_x_origin)
    0000006E 21r00r00         [12]  153 	ld	hl, #_accel_x
    00000071 96               [ 8]  154 	sub	a, (hl)
    00000072 4F               [ 4]  155 	ld	c, a
    00000073 FAr02r00         [16]  156 	ld	a, (#_accel_x_origin + 1)
    00000076 21r01r00         [12]  157 	ld	hl, #_accel_x + 1
    00000079 9E               [ 8]  158 	sbc	a, (hl)
    0000007A 47               [ 4]  159 	ld	b, a
    0000007B 21r05r00         [12]  160 	ld	hl, #_accel_x_relative
    0000007E 79               [ 4]  161 	ld	a, c
    0000007F 22               [ 8]  162 	ld	(hl+), a
    00000080 70               [ 8]  163 	ld	(hl), b
                                    164 ;src/mbc7_accelerometer.c:117: accel_y_relative = (int16_t)(accel_y_origin - accel_y);
    00000081 FAr03r00         [16]  165 	ld	a, (#_accel_y_origin)
    00000084 21r02r00         [12]  166 	ld	hl, #_accel_y
    00000087 96               [ 8]  167 	sub	a, (hl)
    00000088 4F               [ 4]  168 	ld	c, a
    00000089 FAr04r00         [16]  169 	ld	a, (#_accel_y_origin + 1)
    0000008C 21r03r00         [12]  170 	ld	hl, #_accel_y + 1
    0000008F 9E               [ 8]  171 	sbc	a, (hl)
    00000090 47               [ 4]  172 	ld	b, a
    00000091 21r07r00         [12]  173 	ld	hl, #_accel_y_relative
    00000094 79               [ 4]  174 	ld	a, c
    00000095 22               [ 8]  175 	ld	(hl+), a
    00000096 70               [ 8]  176 	ld	(hl), b
                                    177 ;src/mbc7_accelerometer.c:119: }
    00000097 C9               [16]  178 	ret
                                    179 	.area _CODE
                                    180 	.area _INITIALIZER
    00000000                        181 __xinit__accel_origin_set:
    00000000 00                     182 	.db #0x00	;  0
    00000001                        183 __xinit__accel_x_origin:
    00000001 00 00                  184 	.dw #0x0000
    00000003                        185 __xinit__accel_y_origin:
    00000003 00 00                  186 	.dw #0x0000
    00000005                        187 __xinit__accel_x_relative:
    00000005 00 00                  188 	.dw #0x0000
    00000007                        189 __xinit__accel_y_relative:
    00000007 00 00                  190 	.dw #0x0000
                                    191 	.area _CABS (ABS)
