                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler
                                      3 ; Version 4.5.1 #15267 (Mac OS X ppc)
                                      4 ;--------------------------------------------------------
                                      5 	.module main
                                      6 	
                                      7 ;--------------------------------------------------------
                                      8 ; Public variables in this module
                                      9 ;--------------------------------------------------------
                                     10 	.globl _main
                                     11 	.globl _vsync_no_halt
                                     12 	.globl _mbc7_accel_update
                                     13 	.globl _mbc7_accel_init
                                     14 	.globl _gotoxy
                                     15 	.globl _puts
                                     16 	.globl _printf
                                     17 	.globl _set_sprite_data
                                     18 	.globl _joypad
                                     19 	.globl _joy
                                     20 	.globl _old_joy
                                     21 	.globl _sprite_tile
                                     22 ;--------------------------------------------------------
                                     23 ; special function registers
                                     24 ;--------------------------------------------------------
                                     25 ;--------------------------------------------------------
                                     26 ; ram data
                                     27 ;--------------------------------------------------------
                                     28 	.area _DATA
    00000000                         29 _old_joy::
    00000000                         30 	.ds 1
                                     31 ;--------------------------------------------------------
                                     32 ; ram data
                                     33 ;--------------------------------------------------------
                                     34 	.area _INITIALIZED
    00000000                         35 _joy::
    00000000                         36 	.ds 1
                                     37 ;--------------------------------------------------------
                                     38 ; absolute external ram data
                                     39 ;--------------------------------------------------------
                                     40 	.area _DABS (ABS)
                                     41 ;--------------------------------------------------------
                                     42 ; global & static initialisations
                                     43 ;--------------------------------------------------------
                                     44 	.area _HOME
                                     45 	.area _GSINIT
                                     46 	.area _GSFINAL
                                     47 	.area _GSINIT
                                     48 ;--------------------------------------------------------
                                     49 ; Home
                                     50 ;--------------------------------------------------------
                                     51 	.area _HOME
                                     52 	.area _HOME
                                     53 ;--------------------------------------------------------
                                     54 ; code
                                     55 ;--------------------------------------------------------
                                     56 	.area _CODE
                                     57 ;src/main.c:58: void main(void)
                                     58 ;	---------------------------------
                                     59 ; Function main
                                     60 ; ---------------------------------
    00000000                         61 _main::
    00000000 E8 FA            [16]   62 	add	sp, #-6
                                     63 ;src/main.c:60: bool do_set_origin = false;
    00000002 F8 00            [12]   64 	ldhl	sp,	#0
    00000004 36 00            [12]   65 	ld	(hl), #0x00
                                     66 ;src/main.c:61: bool show_data     = false;
    00000006 F8 05            [12]   67 	ldhl	sp,	#5
    00000008 36 00            [12]   68 	ld	(hl), #0x00
                                     69 ;src/main.c:63: HIDE_SPRITES;
    0000000A F0r00            [12]   70 	ldh	a, (_LCDC_REG + 0)
    0000000C E6 FD            [ 8]   71 	and	a, #0xfd
    0000000E E0r00            [12]   72 	ldh	(_LCDC_REG + 0), a
                                     73 ;src/main.c:65: set_sprite_data(SPR_TILE_0, 1u, sprite_tile);
    00000010 11r64r01         [12]   74 	ld	de, #_sprite_tile
    00000013 D5               [16]   75 	push	de
    00000014 AF               [ 4]   76 	xor	a, a
    00000015 3C               [ 4]   77 	inc	a
    00000016 F5               [16]   78 	push	af
    00000017 CDr00r00         [24]   79 	call	_set_sprite_data
    0000001A E8 04            [16]   80 	add	sp, #4
                                     81 ;../../../include/gb/gb.h:1887: shadow_OAM[nb].tile=tile;
    0000001C 21r02r00         [12]   82 	ld	hl, #(_shadow_OAM + 2)
    0000001F 36 00            [12]   83 	ld	(hl), #0x00
                                     84 ;src/main.c:68: printf("-B to Center\n");
    00000021 11r74r01         [12]   85 	ld	de, #___str_1
    00000024 CDr00r00         [24]   86 	call	_puts
                                     87 ;src/main.c:69: printf("-SELECT toggles info");
    00000027 11r81r01         [12]   88 	ld	de, #___str_2
    0000002A D5               [16]   89 	push	de
    0000002B CDr00r00         [24]   90 	call	_printf
    0000002E E1               [12]   91 	pop	hl
                                     92 ;src/main.c:71: mbc7_accel_init();
    0000002F CDr00r00         [24]   93 	call	_mbc7_accel_init
                                     94 ;src/main.c:73: while(1) {
    00000032                         95 00111$:
                                     96 ;src/main.c:76: INPUT_UPDATE;
    00000032 FAr00r00         [16]   97 	ld	a, (#_joy)
    00000035 EAr00r00         [16]   98 	ld	(#_old_joy),a
    00000038 CDr00r00         [24]   99 	call	_joypad
    0000003B EAr00r00         [16]  100 	ld	(#_joy),a
                                    101 ;src/main.c:77: switch (INPUT_BUTTONPRESS(J_B | J_SELECT)) {
    0000003E FAr00r00         [16]  102 	ld	a, (#_old_joy)
    00000041 F8 03            [12]  103 	ldhl	sp,	#3
    00000043 22               [ 8]  104 	ld	(hl+), a
    00000044 AF               [ 4]  105 	xor	a, a
    00000045 32               [ 8]  106 	ld	(hl-), a
    00000046 3A               [ 8]  107 	ld	a, (hl-)
    00000047 2B               [ 8]  108 	dec	hl
    00000048 2F               [ 4]  109 	cpl
    00000049 22               [ 8]  110 	ld	(hl+), a
    0000004A AF               [ 4]  111 	xor	a, a
    0000004B 2F               [ 4]  112 	cpl
    0000004C 77               [ 8]  113 	ld	(hl), a
    0000004D FAr00r00         [16]  114 	ld	a, (#_joy)
    00000050 F8 04            [12]  115 	ldhl	sp,	#4
    00000052 77               [ 8]  116 	ld	(hl), a
    00000053 3A               [ 8]  117 	ld	a, (hl-)
    00000054 32               [ 8]  118 	ld	(hl-), a
    00000055 2B               [ 8]  119 	dec	hl
    00000056 7E               [ 8]  120 	ld	a, (hl)
    00000057 F8 04            [12]  121 	ldhl	sp,	#4
    00000059 32               [ 8]  122 	ld	(hl-), a
    0000005A 2A               [ 8]  123 	ld	a, (hl+)
    0000005B A6               [ 8]  124 	and	a, (hl)
    0000005C E6 60            [ 8]  125 	and	a, #0x60
    0000005E FE 20            [ 8]  126 	cp	a, #0x20
    00000060 28 06            [12]  127 	jr	Z, 00101$
    00000062 D6 40            [ 8]  128 	sub	a, #0x40
    00000064 28 08            [12]  129 	jr	Z, 00102$
    00000066 18 0C            [12]  130 	jr	00103$
                                    131 ;src/main.c:78: case J_B: do_set_origin = true; break;
    00000068                        132 00101$:
    00000068 F8 00            [12]  133 	ldhl	sp,	#0
    0000006A 36 01            [12]  134 	ld	(hl), #0x01
    0000006C 18 06            [12]  135 	jr	00103$
                                    136 ;src/main.c:79: case J_SELECT: show_data ^= true; break;
    0000006E                        137 00102$:
    0000006E F8 05            [12]  138 	ldhl	sp,	#5
    00000070 7E               [ 8]  139 	ld	a, (hl)
    00000071 EE 01            [ 8]  140 	xor	a, #0x01
    00000073 77               [ 8]  141 	ld	(hl), a
                                    142 ;src/main.c:80: }
    00000074                        143 00103$:
                                    144 ;src/main.c:82: mbc7_accel_update(do_set_origin);
    00000074 F8 00            [12]  145 	ldhl	sp,	#0
    00000076 7E               [ 8]  146 	ld	a, (hl)
    00000077 CDr00r00         [24]  147 	call	_mbc7_accel_update
                                    148 ;src/main.c:85: if (do_set_origin) {
    0000007A F8 00            [12]  149 	ldhl	sp,	#0
    0000007C CB 46            [12]  150 	bit	0, (hl)
    0000007E 28 33            [12]  151 	jr	Z, 00105$
                                    152 ;src/main.c:86: do_set_origin = false;
    00000080 36 00            [12]  153 	ld	(hl), #0x00
                                    154 ;src/main.c:88: gotoxy(0,3);
    00000082 21 00 03         [12]  155 	ld	hl, #0x300
    00000085 E5               [16]  156 	push	hl
    00000086 CDr00r00         [24]  157 	call	_gotoxy
    00000089 E1               [12]  158 	pop	hl
                                    159 ;src/main.c:89: printf("origin x:%x\norigin y:%x", accel_x_origin, accel_y_origin);
    0000008A FAr00r00         [16]  160 	ld	a, (_accel_y_origin)
    0000008D 5F               [ 4]  161 	ld	e, a
    0000008E 21r01r00         [12]  162 	ld	hl, #_accel_y_origin + 1
    00000091 56               [ 8]  163 	ld	d, (hl)
    00000092 D5               [16]  164 	push	de
    00000093 FAr00r00         [16]  165 	ld	a, (_accel_x_origin)
    00000096 5F               [ 4]  166 	ld	e, a
    00000097 21r01r00         [12]  167 	ld	hl, #_accel_x_origin + 1
    0000009A 56               [ 8]  168 	ld	d, (hl)
    0000009B D5               [16]  169 	push	de
    0000009C 11r96r01         [12]  170 	ld	de, #___str_3
    0000009F D5               [16]  171 	push	de
    000000A0 CDr00r00         [24]  172 	call	_printf
    000000A3 E8 06            [16]  173 	add	sp, #6
                                    174 ;src/main.c:90: SHOW_SPRITES;
    000000A5 F0r00            [12]  175 	ldh	a, (_LCDC_REG + 0)
    000000A7 F6 02            [ 8]  176 	or	a, #0x02
    000000A9 E0r00            [12]  177 	ldh	(_LCDC_REG + 0), a
                                    178 ;../../../include/gb/gb.h:1973: OAM_item_t * itm = &shadow_OAM[nb];
    000000AB 21r00r00         [12]  179 	ld	hl, #_shadow_OAM
                                    180 ;../../../include/gb/gb.h:1974: itm->y=y, itm->x=x;
    000000AE 3E 54            [ 8]  181 	ld	a, #0x54
    000000B0 22               [ 8]  182 	ld	(hl+), a
    000000B1 36 54            [12]  183 	ld	(hl), #0x54
                                    184 ;src/main.c:91: move_sprite(SPR_ID_CROSS, SCRN_CENTER_X, SCRN_CENTER_Y);
    000000B3                        185 00105$:
                                    186 ;src/main.c:95: if (accel_origin_set) {
    000000B3 21r00r00         [12]  187 	ld	hl, #_accel_origin_set
    000000B6 CB 46            [12]  188 	bit	0, (hl)
    000000B8 CAr5Br01         [16]  189 	jp	Z, 00109$
                                    190 ;src/main.c:98: scroll_sprite(SPR_ID_CROSS, accel_x_relative / ACCEL_DIVIDE_AMT, accel_y_relative / ACCEL_DIVIDE_AMT);
    000000BB FAr00r00         [16]  191 	ld	a, (_accel_y_relative)
    000000BE 4F               [ 4]  192 	ld	c, a
    000000BF 21r01r00         [12]  193 	ld	hl, #_accel_y_relative + 1
    000000C2 46               [ 8]  194 	ld	b, (hl)
    000000C3 69               [ 4]  195 	ld	l, c
    000000C4 60               [ 4]  196 	ld	h, b
    000000C5 CB 78            [ 8]  197 	bit	7, b
    000000C7 28 04            [12]  198 	jr	Z, 00118$
    000000C9 21 07 00         [12]  199 	ld	hl, #0x0007
    000000CC 09               [ 8]  200 	add	hl, bc
    000000CD                        201 00118$:
    000000CD 4D               [ 4]  202 	ld	c, l
    000000CE CB 2C            [ 8]  203 	sra	h
    000000D0 CB 19            [ 8]  204 	rr	c
    000000D2 CB 2C            [ 8]  205 	sra	h
    000000D4 CB 19            [ 8]  206 	rr	c
    000000D6 CB 2C            [ 8]  207 	sra	h
    000000D8 CB 19            [ 8]  208 	rr	c
    000000DA FAr00r00         [16]  209 	ld	a, (#_accel_x_relative)
    000000DD F8 01            [12]  210 	ldhl	sp,	#1
    000000DF 77               [ 8]  211 	ld	(hl), a
    000000E0 FAr01r00         [16]  212 	ld	a, (#_accel_x_relative + 1)
    000000E3 F8 02            [12]  213 	ldhl	sp,	#2
    000000E5 32               [ 8]  214 	ld	(hl-), a
    000000E6 2A               [ 8]  215 	ld	a, (hl+)
    000000E7 23               [ 8]  216 	inc	hl
    000000E8 32               [ 8]  217 	ld	(hl-), a
    000000E9 2A               [ 8]  218 	ld	a, (hl+)
    000000EA 23               [ 8]  219 	inc	hl
    000000EB 32               [ 8]  220 	ld	(hl-), a
    000000EC 2B               [ 8]  221 	dec	hl
    000000ED CB 7E            [12]  222 	bit	7, (hl)
    000000EF 28 12            [12]  223 	jr	Z, 00119$
    000000F1 2B               [ 8]  224 	dec	hl
    000000F2 2A               [ 8]  225 	ld	a, (hl+)
    000000F3 5F               [ 4]  226 	ld	e, a
    000000F4 56               [ 8]  227 	ld	d, (hl)
    000000F5 21 07 00         [12]  228 	ld	hl, #0x0007
    000000F8 19               [ 8]  229 	add	hl, de
    000000F9 E5               [16]  230 	push	hl
    000000FA 7D               [ 4]  231 	ld	a, l
    000000FB F8 05            [12]  232 	ldhl	sp,	#5
    000000FD 77               [ 8]  233 	ld	(hl), a
    000000FE E1               [12]  234 	pop	hl
    000000FF 7C               [ 4]  235 	ld	a, h
    00000100 F8 04            [12]  236 	ldhl	sp,	#4
    00000102 77               [ 8]  237 	ld	(hl), a
    00000103                        238 00119$:
    00000103 F8 03            [12]  239 	ldhl	sp,#3
    00000105 2A               [ 8]  240 	ld	a, (hl+)
    00000106 5F               [ 4]  241 	ld	e, a
    00000107 56               [ 8]  242 	ld	d, (hl)
    00000108 CB 2A            [ 8]  243 	sra	d
    0000010A CB 1B            [ 8]  244 	rr	e
    0000010C CB 2A            [ 8]  245 	sra	d
    0000010E CB 1B            [ 8]  246 	rr	e
    00000110 CB 2A            [ 8]  247 	sra	d
    00000112 CB 1B            [ 8]  248 	rr	e
                                    249 ;../../../include/gb/gb.h:1989: OAM_item_t * itm = &shadow_OAM[nb];
                                    250 ;../../../include/gb/gb.h:1990: itm->y+=y, itm->x+=x;
    00000114 21r00r00         [12]  251 	ld	hl, #_shadow_OAM
    00000117 7E               [ 8]  252 	ld	a, (hl)
    00000118 81               [ 4]  253 	add	a, c
    00000119 77               [ 8]  254 	ld	(hl), a
    0000011A 21r01r00         [12]  255 	ld	hl, #_shadow_OAM + 1
    0000011D 7E               [ 8]  256 	ld	a, (hl)
    0000011E 83               [ 4]  257 	add	a, e
    0000011F 77               [ 8]  258 	ld	(hl), a
                                    259 ;src/main.c:100: if (show_data) {
    00000120 F8 05            [12]  260 	ldhl	sp,	#5
    00000122 CB 46            [12]  261 	bit	0, (hl)
    00000124 28 35            [12]  262 	jr	Z, 00109$
                                    263 ;src/main.c:101: gotoxy(0,6);
    00000126 21 00 06         [12]  264 	ld	hl, #0x600
    00000129 E5               [16]  265 	push	hl
    0000012A CDr00r00         [24]  266 	call	_gotoxy
    0000012D E1               [12]  267 	pop	hl
                                    268 ;src/main.c:105: "%d   \n",
    0000012E FAr00r00         [16]  269 	ld	a, (_accel_y_relative)
    00000131 5F               [ 4]  270 	ld	e, a
    00000132 21r01r00         [12]  271 	ld	hl, #_accel_y_relative + 1
    00000135 56               [ 8]  272 	ld	d, (hl)
    00000136 D5               [16]  273 	push	de
    00000137 FAr00r00         [16]  274 	ld	a, (_accel_x_relative)
    0000013A 5F               [ 4]  275 	ld	e, a
    0000013B 21r01r00         [12]  276 	ld	hl, #_accel_x_relative + 1
    0000013E 56               [ 8]  277 	ld	d, (hl)
    0000013F D5               [16]  278 	push	de
    00000140 FAr00r00         [16]  279 	ld	a, (_accel_y)
    00000143 5F               [ 4]  280 	ld	e, a
    00000144 21r01r00         [12]  281 	ld	hl, #_accel_y + 1
    00000147 56               [ 8]  282 	ld	d, (hl)
    00000148 D5               [16]  283 	push	de
    00000149 FAr00r00         [16]  284 	ld	a, (_accel_x)
    0000014C 5F               [ 4]  285 	ld	e, a
    0000014D 21r01r00         [12]  286 	ld	hl, #_accel_x + 1
    00000150 56               [ 8]  287 	ld	d, (hl)
    00000151 D5               [16]  288 	push	de
    00000152 11rAEr01         [12]  289 	ld	de, #___str_4
    00000155 D5               [16]  290 	push	de
    00000156 CDr00r00         [24]  291 	call	_printf
    00000159 E8 0A            [16]  292 	add	sp, #10
    0000015B                        293 00109$:
                                    294 ;src/main.c:114: vsync_no_halt();
    0000015B CDr00r00         [24]  295 	call	_vsync_no_halt
    0000015E C3r32r00         [16]  296 	jp	00111$
                                    297 ;src/main.c:116: }
    00000161 E8 06            [16]  298 	add	sp, #6
    00000163 C9               [16]  299 	ret
    00000164                        300 _sprite_tile:
    00000164 3C                     301 	.db #0x3c	; 60
    00000165 18                     302 	.db #0x18	; 24
    00000166 7E                     303 	.db #0x7e	; 126
    00000167 18                     304 	.db #0x18	; 24
    00000168 FF                     305 	.db #0xff	; 255
    00000169 18                     306 	.db #0x18	; 24
    0000016A FF                     307 	.db #0xff	; 255
    0000016B FF                     308 	.db #0xff	; 255
    0000016C FF                     309 	.db #0xff	; 255
    0000016D FF                     310 	.db #0xff	; 255
    0000016E FF                     311 	.db #0xff	; 255
    0000016F 18                     312 	.db #0x18	; 24
    00000170 7E                     313 	.db #0x7e	; 126
    00000171 18                     314 	.db #0x18	; 24
    00000172 3C                     315 	.db #0x3c	; 60
    00000173 18                     316 	.db #0x18	; 24
    00000174                        317 ___str_1:
    00000174 2D 42 20 74 6F 20 43   318 	.ascii "-B to Center"
             65 6E 74 65 72
    00000180 00                     319 	.db 0x00
    00000181                        320 ___str_2:
    00000181 2D 53 45 4C 45 43 54   321 	.ascii "-SELECT toggles info"
             20 74 6F 67 67 6C 65
             73 20 69 6E 66 6F
    00000195 00                     322 	.db 0x00
    00000196                        323 ___str_3:
    00000196 6F 72 69 67 69 6E 20   324 	.ascii "origin x:%x"
             78 3A 25 78
    000001A1 0A                     325 	.db 0x0a
    000001A2 6F 72 69 67 69 6E 20   326 	.ascii "origin y:%x"
             79 3A 25 78
    000001AD 00                     327 	.db 0x00
    000001AE                        328 ___str_4:
    000001AE 25 78                  329 	.ascii "%x"
    000001B0 0A                     330 	.db 0x0a
    000001B1 25 78                  331 	.ascii "%x"
    000001B3 0A                     332 	.db 0x0a
    000001B4 25 64 20 20 20         333 	.ascii "%d   "
    000001B9 0A                     334 	.db 0x0a
    000001BA 25 64 20 20 20         335 	.ascii "%d   "
    000001BF 0A                     336 	.db 0x0a
    000001C0 00                     337 	.db 0x00
                                    338 	.area _CODE
                                    339 	.area _INITIALIZER
    00000000                        340 __xinit__joy:
    00000000 00                     341 	.db #0x00	; 0
                                    342 	.area _CABS (ABS)
