                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler
                                      3 ; Version 4.5.1 #15267 (Mac OS X ppc)
                                      4 ;--------------------------------------------------------
                                      5 	.module megaduck_rtc
                                      6 	
                                      7 ;--------------------------------------------------------
                                      8 ; Public variables in this module
                                      9 ;--------------------------------------------------------
                                     10 	.globl _duck_io_send_cmd_and_receive_buffer
                                     11 	.globl _duck_io_send_cmd_and_buffer
                                     12 	.globl _duck_io_set_rtc
                                     13 	.globl _duck_io_get_rtc
                                     14 ;--------------------------------------------------------
                                     15 ; special function registers
                                     16 ;--------------------------------------------------------
                                     17 ;--------------------------------------------------------
                                     18 ; ram data
                                     19 ;--------------------------------------------------------
                                     20 	.area _DATA
                                     21 ;--------------------------------------------------------
                                     22 ; ram data
                                     23 ;--------------------------------------------------------
                                     24 	.area _INITIALIZED
                                     25 ;--------------------------------------------------------
                                     26 ; absolute external ram data
                                     27 ;--------------------------------------------------------
                                     28 	.area _DABS (ABS)
                                     29 ;--------------------------------------------------------
                                     30 ; global & static initialisations
                                     31 ;--------------------------------------------------------
                                     32 	.area _HOME
                                     33 	.area _GSINIT
                                     34 	.area _GSFINAL
                                     35 	.area _GSINIT
                                     36 ;--------------------------------------------------------
                                     37 ; Home
                                     38 ;--------------------------------------------------------
                                     39 	.area _HOME
                                     40 	.area _HOME
                                     41 ;--------------------------------------------------------
                                     42 ; code
                                     43 ;--------------------------------------------------------
                                     44 	.area _CODE
                                     45 ;src/megaduck_rtc.c:12: static uint8_t bcd_to_u8(uint8_t i)
                                     46 ;	---------------------------------
                                     47 ; Function bcd_to_u8
                                     48 ; ---------------------------------
    00000000                         49 _bcd_to_u8:
                                     50 ;src/megaduck_rtc.c:14: return (i & 0xFu) + ((i >> 4) * 10u);
    00000000 F5               [16]   51 	push	af
    00000001 E6 0F            [ 8]   52 	and	a, #0x0f
    00000003 4F               [ 4]   53 	ld	c, a
    00000004 F1               [12]   54 	pop	af
    00000005 CB 37            [ 8]   55 	swap	a
    00000007 E6 0F            [ 8]   56 	and	a, #0x0f
    00000009 5F               [ 4]   57 	ld	e, a
    0000000A 87               [ 4]   58 	add	a, a
    0000000B 87               [ 4]   59 	add	a, a
    0000000C 83               [ 4]   60 	add	a, e
    0000000D 87               [ 4]   61 	add	a, a
    0000000E 81               [ 4]   62 	add	a, c
                                     63 ;src/megaduck_rtc.c:15: }
    0000000F C9               [16]   64 	ret
                                     65 ;src/megaduck_rtc.c:17: static uint8_t u8_to_bcd(uint8_t i)
                                     66 ;	---------------------------------
                                     67 ; Function u8_to_bcd
                                     68 ; ---------------------------------
    00000010                         69 _u8_to_bcd:
                                     70 ;src/megaduck_rtc.c:19: return (i % 10u) + ((i / 10u) << 4);
    00000010 57               [ 4]   71 	ld	d, a
    00000011 D5               [16]   72 	push	de
    00000012 1E 0A            [ 8]   73 	ld	e, #0x0a
    00000014 7A               [ 4]   74 	ld	a, d
    00000015 CDr00r00         [24]   75 	call	__moduchar
    00000018 D1               [12]   76 	pop	de
    00000019 C5               [16]   77 	push	bc
    0000001A 1E 0A            [ 8]   78 	ld	e, #0x0a
    0000001C 7A               [ 4]   79 	ld	a, d
    0000001D CDr00r00         [24]   80 	call	__divuchar
    00000020 79               [ 4]   81 	ld	a, c
    00000021 C1               [12]   82 	pop	bc
    00000022 CB 37            [ 8]   83 	swap	a
    00000024 E6 F0            [ 8]   84 	and	a, #0xf0
    00000026 81               [ 4]   85 	add	a, c
                                     86 ;src/megaduck_rtc.c:20: }
    00000027 C9               [16]   87 	ret
                                     88 ;src/megaduck_rtc.c:47: bool duck_io_set_rtc(duck_rtc_data_t * p_rtc) {
                                     89 ;	---------------------------------
                                     90 ; Function duck_io_set_rtc
                                     91 ; ---------------------------------
    00000028                         92 _duck_io_set_rtc::
    00000028 4B               [ 4]   93 	ld	c, e
    00000029 42               [ 4]   94 	ld	b, d
                                     95 ;src/megaduck_rtc.c:52: if (p_rtc->year < 2000u) year_to_send = p_rtc->year - 1900u;
    0000002A 69               [ 4]   96 	ld	l, c
    0000002B 60               [ 4]   97 	ld	h, b
    0000002C 2A               [ 8]   98 	ld	a,	(hl+)
    0000002D 66               [ 8]   99 	ld	h, (hl)
    0000002E 6F               [ 4]  100 	ld	l, a
    0000002F 5D               [ 4]  101 	ld	e, l
    00000030 54               [ 4]  102 	ld	d, h
    00000031 7B               [ 4]  103 	ld	a, e
    00000032 D6 D0            [ 8]  104 	sub	a, #0xd0
    00000034 7A               [ 4]  105 	ld	a, d
    00000035 DE 07            [ 8]  106 	sbc	a, #0x07
    00000037 30 06            [12]  107 	jr	NC, 00102$
    00000039 7D               [ 4]  108 	ld	a, l
    0000003A C6 94            [ 8]  109 	add	a, #0x94
    0000003C 5F               [ 4]  110 	ld	e, a
    0000003D 18 04            [12]  111 	jr	00103$
    0000003F                        112 00102$:
                                    113 ;src/megaduck_rtc.c:53: else                           year_to_send = p_rtc->year - 2000u;
    0000003F 7D               [ 4]  114 	ld	a, l
    00000040 C6 30            [ 8]  115 	add	a, #0x30
    00000042 5F               [ 4]  116 	ld	e, a
    00000043                        117 00103$:
                                    118 ;src/megaduck_rtc.c:55: duck_io_tx_buf[0] = u8_to_bcd(year_to_send);
    00000043 C5               [16]  119 	push	bc
    00000044 7B               [ 4]  120 	ld	a, e
    00000045 CDr10r00         [24]  121 	call	_u8_to_bcd
    00000048 C1               [12]  122 	pop	bc
    00000049 EAr00r00         [16]  123 	ld	(#_duck_io_tx_buf),a
                                    124 ;src/megaduck_rtc.c:56: duck_io_tx_buf[1] = u8_to_bcd(p_rtc->mon);
    0000004C 69               [ 4]  125 	ld	l, c
    0000004D 60               [ 4]  126 	ld	h, b
    0000004E 23               [ 8]  127 	inc	hl
    0000004F 23               [ 8]  128 	inc	hl
    00000050 7E               [ 8]  129 	ld	a, (hl)
    00000051 C5               [16]  130 	push	bc
    00000052 CDr10r00         [24]  131 	call	_u8_to_bcd
    00000055 C1               [12]  132 	pop	bc
    00000056 EAr01r00         [16]  133 	ld	(#(_duck_io_tx_buf + 1)),a
                                    134 ;src/megaduck_rtc.c:57: duck_io_tx_buf[2] = u8_to_bcd(p_rtc->day);
    00000059 69               [ 4]  135 	ld	l, c
    0000005A 60               [ 4]  136 	ld	h, b
    0000005B 23               [ 8]  137 	inc	hl
    0000005C 23               [ 8]  138 	inc	hl
    0000005D 23               [ 8]  139 	inc	hl
    0000005E 7E               [ 8]  140 	ld	a, (hl)
    0000005F C5               [16]  141 	push	bc
    00000060 CDr10r00         [24]  142 	call	_u8_to_bcd
    00000063 C1               [12]  143 	pop	bc
    00000064 EAr02r00         [16]  144 	ld	(#(_duck_io_tx_buf + 2)),a
                                    145 ;src/megaduck_rtc.c:58: duck_io_tx_buf[3] = u8_to_bcd(p_rtc->weekday);
    00000067 21 04 00         [12]  146 	ld	hl, #0x0004
    0000006A 09               [ 8]  147 	add	hl, bc
    0000006B 7E               [ 8]  148 	ld	a, (hl)
    0000006C C5               [16]  149 	push	bc
    0000006D CDr10r00         [24]  150 	call	_u8_to_bcd
    00000070 C1               [12]  151 	pop	bc
    00000071 EAr03r00         [16]  152 	ld	(#(_duck_io_tx_buf + 3)),a
                                    153 ;src/megaduck_rtc.c:60: duck_io_tx_buf[4] = p_rtc->ampm;
    00000074 21 05 00         [12]  154 	ld	hl, #0x0005
    00000077 09               [ 8]  155 	add	hl, bc
    00000078 7E               [ 8]  156 	ld	a, (hl)
    00000079 EAr04r00         [16]  157 	ld	(#(_duck_io_tx_buf + 4)),a
                                    158 ;src/megaduck_rtc.c:61: duck_io_tx_buf[5] = p_rtc->hour;
    0000007C 21 06 00         [12]  159 	ld	hl, #0x0006
    0000007F 09               [ 8]  160 	add	hl, bc
    00000080 7E               [ 8]  161 	ld	a, (hl)
    00000081 EAr05r00         [16]  162 	ld	(#(_duck_io_tx_buf + 5)),a
                                    163 ;src/megaduck_rtc.c:62: duck_io_tx_buf[6] = p_rtc->min;
    00000084 21 07 00         [12]  164 	ld	hl, #0x0007
    00000087 09               [ 8]  165 	add	hl, bc
    00000088 7E               [ 8]  166 	ld	a, (hl)
    00000089 EAr06r00         [16]  167 	ld	(#(_duck_io_tx_buf + 6)),a
                                    168 ;src/megaduck_rtc.c:63: duck_io_tx_buf[7] = p_rtc->sec;
    0000008C 21 08 00         [12]  169 	ld	hl, #0x0008
    0000008F 09               [ 8]  170 	add	hl, bc
    00000090 7E               [ 8]  171 	ld	a, (hl)
    00000091 EAr07r00         [16]  172 	ld	(#(_duck_io_tx_buf + 7)),a
                                    173 ;src/megaduck_rtc.c:65: duck_io_tx_buf_len = DUCK_IO_LEN_RTC_SET;
    00000094 21r00r00         [12]  174 	ld	hl, #_duck_io_tx_buf_len
    00000097 36 08            [12]  175 	ld	(hl), #0x08
                                    176 ;src/megaduck_rtc.c:67: if (duck_io_send_cmd_and_buffer(DUCK_IO_CMD_SET_RTC)) {
    00000099 3E 0B            [ 8]  177 	ld	a, #0x0b
    0000009B CDr00r00         [24]  178 	call	_duck_io_send_cmd_and_buffer
    0000009E CB 47            [ 8]  179 	bit	0,a
                                    180 ;src/megaduck_rtc.c:68: return true;
                                    181 ;src/megaduck_rtc.c:70: return false;
    000000A0 3E 01            [ 8]  182 	ld	a, #0x01
    000000A2 C0               [20]  183 	ret	NZ
    000000A3 AF               [ 4]  184 	xor	a, a
                                    185 ;src/megaduck_rtc.c:72: }
    000000A4 C9               [16]  186 	ret
                                    187 ;src/megaduck_rtc.c:79: bool duck_io_get_rtc(duck_rtc_data_t * p_rtc) {
                                    188 ;	---------------------------------
                                    189 ; Function duck_io_get_rtc
                                    190 ; ---------------------------------
    000000A5                        191 _duck_io_get_rtc::
    000000A5 E8 FD            [16]  192 	add	sp, #-3
    000000A7 F8 01            [12]  193 	ldhl	sp,	#1
    000000A9 7B               [ 4]  194 	ld	a, e
    000000AA 22               [ 8]  195 	ld	(hl+), a
    000000AB 72               [ 8]  196 	ld	(hl), d
                                    197 ;src/megaduck_rtc.c:81: if (duck_io_send_cmd_and_receive_buffer(DUCK_IO_CMD_GET_RTC)) {
    000000AC 3E 0C            [ 8]  198 	ld	a, #0x0c
    000000AE CDr00r00         [24]  199 	call	_duck_io_send_cmd_and_receive_buffer
    000000B1 CB 47            [ 8]  200 	bit	0,a
    000000B3 CAr8Br01         [16]  201 	jp	Z, 00107$
                                    202 ;src/megaduck_rtc.c:82: if (duck_io_rx_buf_len == DUCK_IO_LEN_RTC_GET) {
    000000B6 FAr00r00         [16]  203 	ld	a, (#_duck_io_rx_buf_len)
    000000B9 D6 08            [ 8]  204 	sub	a, #0x08
    000000BB C2r8Br01         [16]  205 	jp	NZ, 00107$
                                    206 ;src/megaduck_rtc.c:92: p_rtc->year = bcd_to_u8(duck_io_rx_buf[DUCK_IO_RTC_YEAR]);
    000000BE F8 01            [12]  207 	ldhl	sp,	#1
    000000C0 2A               [ 8]  208 	ld	a, (hl+)
    000000C1 4F               [ 4]  209 	ld	c, a
    000000C2 46               [ 8]  210 	ld	b, (hl)
    000000C3 FAr00r00         [16]  211 	ld	a, (#_duck_io_rx_buf + 0)
    000000C6 C5               [16]  212 	push	bc
    000000C7 CDr00r00         [24]  213 	call	_bcd_to_u8
    000000CA C1               [12]  214 	pop	bc
    000000CB 5F               [ 4]  215 	ld	e, a
    000000CC 16 00            [ 8]  216 	ld	d, #0x00
    000000CE 69               [ 4]  217 	ld	l, c
    000000CF 60               [ 4]  218 	ld	h, b
    000000D0 7B               [ 4]  219 	ld	a, e
    000000D1 22               [ 8]  220 	ld	(hl+), a
    000000D2 72               [ 8]  221 	ld	(hl), d
                                    222 ;src/megaduck_rtc.c:93: if (p_rtc->year >= 92) p_rtc->year += 1900u;
    000000D3 F8 00            [12]  223 	ldhl	sp,	#0
    000000D5 73               [ 8]  224 	ld	(hl), e
    000000D6 69               [ 4]  225 	ld	l, c
    000000D7 60               [ 4]  226 	ld	h, b
    000000D8 2A               [ 8]  227 	ld	a,	(hl+)
    000000D9 66               [ 8]  228 	ld	h, (hl)
    000000DA 5F               [ 4]  229 	ld	e, a
    000000DB 54               [ 4]  230 	ld	d, h
    000000DC F8 00            [12]  231 	ldhl	sp,	#0
    000000DE 7E               [ 8]  232 	ld	a, (hl)
    000000DF D6 5C            [ 8]  233 	sub	a, #0x5c
    000000E1 38 0B            [12]  234 	jr	C, 00102$
    000000E3 21 6C 07         [12]  235 	ld	hl, #0x076c
    000000E6 19               [ 8]  236 	add	hl, de
    000000E7 7D               [ 4]  237 	ld	a, l
    000000E8 02               [ 8]  238 	ld	(bc), a
    000000E9 03               [ 8]  239 	inc	bc
    000000EA 7C               [ 4]  240 	ld	a, h
    000000EB 02               [ 8]  241 	ld	(bc), a
    000000EC 18 09            [12]  242 	jr	00103$
    000000EE                        243 00102$:
                                    244 ;src/megaduck_rtc.c:94: else                p_rtc->year += 2000u;
    000000EE 21 D0 07         [12]  245 	ld	hl, #0x07d0
    000000F1 19               [ 8]  246 	add	hl, de
    000000F2 7D               [ 4]  247 	ld	a, l
    000000F3 02               [ 8]  248 	ld	(bc), a
    000000F4 03               [ 8]  249 	inc	bc
    000000F5 7C               [ 4]  250 	ld	a, h
    000000F6 02               [ 8]  251 	ld	(bc), a
    000000F7                        252 00103$:
                                    253 ;src/megaduck_rtc.c:96: p_rtc->mon     = bcd_to_u8(duck_io_rx_buf[DUCK_IO_RTC_MON]);
    000000F7 F8 01            [12]  254 	ldhl	sp,	#1
    000000F9 2A               [ 8]  255 	ld	a, (hl+)
    000000FA 4F               [ 4]  256 	ld	c, a
    000000FB 46               [ 8]  257 	ld	b, (hl)
    000000FC 03               [ 8]  258 	inc	bc
    000000FD 03               [ 8]  259 	inc	bc
    000000FE FAr01r00         [16]  260 	ld	a, (#(_duck_io_rx_buf + 1) + 0)
    00000101 C5               [16]  261 	push	bc
    00000102 CDr00r00         [24]  262 	call	_bcd_to_u8
    00000105 C1               [12]  263 	pop	bc
    00000106 02               [ 8]  264 	ld	(bc), a
                                    265 ;src/megaduck_rtc.c:97: p_rtc->day     = bcd_to_u8(duck_io_rx_buf[DUCK_IO_RTC_DAY]);
    00000107 F8 01            [12]  266 	ldhl	sp,	#1
    00000109 2A               [ 8]  267 	ld	a, (hl+)
    0000010A 5F               [ 4]  268 	ld	e, a
    0000010B 56               [ 8]  269 	ld	d, (hl)
    0000010C 13               [ 8]  270 	inc	de
    0000010D 13               [ 8]  271 	inc	de
    0000010E 13               [ 8]  272 	inc	de
    0000010F FAr02r00         [16]  273 	ld	a, (#_duck_io_rx_buf + 2)
    00000112 C5               [16]  274 	push	bc
    00000113 D5               [16]  275 	push	de
    00000114 CDr00r00         [24]  276 	call	_bcd_to_u8
    00000117 D1               [12]  277 	pop	de
    00000118 C1               [12]  278 	pop	bc
    00000119 12               [ 8]  279 	ld	(de), a
                                    280 ;src/megaduck_rtc.c:98: p_rtc->mon     = bcd_to_u8(duck_io_rx_buf[DUCK_IO_RTC_MON]);
    0000011A FAr01r00         [16]  281 	ld	a, (#(_duck_io_rx_buf + 1) + 0)
    0000011D C5               [16]  282 	push	bc
    0000011E CDr00r00         [24]  283 	call	_bcd_to_u8
    00000121 C1               [12]  284 	pop	bc
    00000122 02               [ 8]  285 	ld	(bc), a
                                    286 ;src/megaduck_rtc.c:99: p_rtc->weekday = bcd_to_u8(duck_io_rx_buf[DUCK_IO_RTC_WEEKDAY]);
    00000123 F8 01            [12]  287 	ldhl	sp,#1
    00000125 2A               [ 8]  288 	ld	a, (hl+)
    00000126 5F               [ 4]  289 	ld	e, a
    00000127 56               [ 8]  290 	ld	d, (hl)
    00000128 21 04 00         [12]  291 	ld	hl, #0x0004
    0000012B 19               [ 8]  292 	add	hl, de
    0000012C 4D               [ 4]  293 	ld	c, l
    0000012D 44               [ 4]  294 	ld	b, h
    0000012E FAr03r00         [16]  295 	ld	a, (#(_duck_io_rx_buf + 3) + 0)
    00000131 C5               [16]  296 	push	bc
    00000132 CDr00r00         [24]  297 	call	_bcd_to_u8
    00000135 C1               [12]  298 	pop	bc
    00000136 02               [ 8]  299 	ld	(bc), a
                                    300 ;src/megaduck_rtc.c:101: p_rtc->ampm    = bcd_to_u8(duck_io_rx_buf[DUCK_IO_RTC_AMPM]);
    00000137 F8 01            [12]  301 	ldhl	sp,#1
    00000139 2A               [ 8]  302 	ld	a, (hl+)
    0000013A 5F               [ 4]  303 	ld	e, a
    0000013B 56               [ 8]  304 	ld	d, (hl)
    0000013C 21 05 00         [12]  305 	ld	hl, #0x0005
    0000013F 19               [ 8]  306 	add	hl, de
    00000140 4D               [ 4]  307 	ld	c, l
    00000141 44               [ 4]  308 	ld	b, h
    00000142 FAr04r00         [16]  309 	ld	a, (#(_duck_io_rx_buf + 4) + 0)
    00000145 C5               [16]  310 	push	bc
    00000146 CDr00r00         [24]  311 	call	_bcd_to_u8
    00000149 C1               [12]  312 	pop	bc
    0000014A 02               [ 8]  313 	ld	(bc), a
                                    314 ;src/megaduck_rtc.c:102: p_rtc->hour    = bcd_to_u8(duck_io_rx_buf[DUCK_IO_RTC_HOUR]);
    0000014B F8 01            [12]  315 	ldhl	sp,#1
    0000014D 2A               [ 8]  316 	ld	a, (hl+)
    0000014E 5F               [ 4]  317 	ld	e, a
    0000014F 56               [ 8]  318 	ld	d, (hl)
    00000150 21 06 00         [12]  319 	ld	hl, #0x0006
    00000153 19               [ 8]  320 	add	hl, de
    00000154 4D               [ 4]  321 	ld	c, l
    00000155 44               [ 4]  322 	ld	b, h
    00000156 FAr05r00         [16]  323 	ld	a, (#(_duck_io_rx_buf + 5) + 0)
    00000159 C5               [16]  324 	push	bc
    0000015A CDr00r00         [24]  325 	call	_bcd_to_u8
    0000015D C1               [12]  326 	pop	bc
    0000015E 02               [ 8]  327 	ld	(bc), a
                                    328 ;src/megaduck_rtc.c:103: p_rtc->min     = bcd_to_u8(duck_io_rx_buf[DUCK_IO_RTC_MIN]);
    0000015F F8 01            [12]  329 	ldhl	sp,#1
    00000161 2A               [ 8]  330 	ld	a, (hl+)
    00000162 5F               [ 4]  331 	ld	e, a
    00000163 56               [ 8]  332 	ld	d, (hl)
    00000164 21 07 00         [12]  333 	ld	hl, #0x0007
    00000167 19               [ 8]  334 	add	hl, de
    00000168 4D               [ 4]  335 	ld	c, l
    00000169 44               [ 4]  336 	ld	b, h
    0000016A FAr06r00         [16]  337 	ld	a, (#(_duck_io_rx_buf + 6) + 0)
    0000016D C5               [16]  338 	push	bc
    0000016E CDr00r00         [24]  339 	call	_bcd_to_u8
    00000171 C1               [12]  340 	pop	bc
    00000172 02               [ 8]  341 	ld	(bc), a
                                    342 ;src/megaduck_rtc.c:104: p_rtc->sec     = bcd_to_u8(duck_io_rx_buf[DUCK_IO_RTC_SEC]);
    00000173 F8 01            [12]  343 	ldhl	sp,#1
    00000175 2A               [ 8]  344 	ld	a, (hl+)
    00000176 5F               [ 4]  345 	ld	e, a
    00000177 56               [ 8]  346 	ld	d, (hl)
    00000178 21 08 00         [12]  347 	ld	hl, #0x0008
    0000017B 19               [ 8]  348 	add	hl, de
    0000017C 4D               [ 4]  349 	ld	c, l
    0000017D 44               [ 4]  350 	ld	b, h
    0000017E FAr07r00         [16]  351 	ld	a, (#(_duck_io_rx_buf + 7) + 0)
    00000181 C5               [16]  352 	push	bc
    00000182 CDr00r00         [24]  353 	call	_bcd_to_u8
    00000185 C1               [12]  354 	pop	bc
    00000186 02               [ 8]  355 	ld	(bc), a
                                    356 ;src/megaduck_rtc.c:105: return true;
    00000187 3E 01            [ 8]  357 	ld	a, #0x01
    00000189 18 01            [12]  358 	jr	00108$
    0000018B                        359 00107$:
                                    360 ;src/megaduck_rtc.c:108: return false;
    0000018B AF               [ 4]  361 	xor	a, a
    0000018C                        362 00108$:
                                    363 ;src/megaduck_rtc.c:109: }
    0000018C E8 03            [16]  364 	add	sp, #3
    0000018E C9               [16]  365 	ret
                                    366 	.area _CODE
                                    367 	.area _INITIALIZER
                                    368 	.area _CABS (ABS)
