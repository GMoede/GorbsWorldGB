                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler
                                      3 ; Version 4.5.1 #15267 (Mac OS X ppc)
                                      4 ;--------------------------------------------------------
                                      5 	.module text_scroller
                                      6 	
                                      7 ;--------------------------------------------------------
                                      8 ; Public variables in this module
                                      9 ;--------------------------------------------------------
                                     10 	.globl _main
                                     11 	.globl _scanline_isr
                                     12 	.globl _printf
                                     13 	.globl _font_set
                                     14 	.globl _font_load
                                     15 	.globl _font_init
                                     16 	.globl _get_bkg_xy_addr
                                     17 	.globl _set_vram_byte
                                     18 	.globl _fill_rect_compat
                                     19 	.globl _vsync
                                     20 	.globl _add_LCD
                                     21 	.globl _set_interrupts
                                     22 	.globl _scroller_next_char
                                     23 	.globl _scroller_x
                                     24 	.globl _scanline_offsets
                                     25 	.globl _limit
                                     26 	.globl _base
                                     27 	.globl _scroller_vram_addr
                                     28 	.globl _scroller_text
                                     29 	.globl _scanline_offsets_tbl
                                     30 	.globl _shake_tbl
                                     31 ;--------------------------------------------------------
                                     32 ; special function registers
                                     33 ;--------------------------------------------------------
                         00000000    34 _GG_STATE	=	0x0000
                         00000001    35 _GG_EXT_7BIT	=	0x0001
                         00000002    36 _GG_EXT_CTL	=	0x0002
                         00000003    37 _GG_SIO_SEND	=	0x0003
                         00000004    38 _GG_SIO_RECV	=	0x0004
                         00000005    39 _GG_SIO_CTL	=	0x0005
                         00000006    40 _GG_SOUND_PAN	=	0x0006
                         0000003E    41 _MEMORY_CTL	=	0x003e
                         0000003F    42 _JOY_CTL	=	0x003f
                         0000007E    43 _VCOUNTER	=	0x007e
                         0000007F    44 _PSG	=	0x007f
                         0000007F    45 _HCOUNTER	=	0x007f
                         000000BE    46 _VDP_DATA	=	0x00be
                         000000BF    47 _VDP_CMD	=	0x00bf
                         000000BF    48 _VDP_STATUS	=	0x00bf
                         000000DC    49 _JOY_PORT1	=	0x00dc
                         000000DD    50 _JOY_PORT2	=	0x00dd
                         000000F0    51 _FMADDRESS	=	0x00f0
                         000000F1    52 _FMDATA	=	0x00f1
                         000000F2    53 _AUDIOCTRL	=	0x00f2
                                     54 ;--------------------------------------------------------
                                     55 ; ram data
                                     56 ;--------------------------------------------------------
                                     57 	.area _DATA
                         0000FFFC    58 _RAM_CONTROL	=	0xfffc
                         0000FFF8    59 _GLASSES_3D	=	0xfff8
                         0000FFFD    60 _MAP_FRAME0	=	0xfffd
                         0000FFFE    61 _MAP_FRAME1	=	0xfffe
                         0000FFFF    62 _MAP_FRAME2	=	0xffff
    00000000                         63 _scroller_vram_addr::
    00000000                         64 	.ds 2
    00000002                         65 _base::
    00000002                         66 	.ds 2
    00000004                         67 _limit::
    00000004                         68 	.ds 2
                                     69 ;--------------------------------------------------------
                                     70 ; ram data
                                     71 ;--------------------------------------------------------
                                     72 	.area _INITIALIZED
    00000000                         73 _scanline_offsets::
    00000000                         74 	.ds 2
    00000002                         75 _scroller_x::
    00000002                         76 	.ds 1
    00000003                         77 _scroller_next_char::
    00000003                         78 	.ds 2
                                     79 ;--------------------------------------------------------
                                     80 ; absolute external ram data
                                     81 ;--------------------------------------------------------
                                     82 	.area _DABS (ABS)
                                     83 ;--------------------------------------------------------
                                     84 ; global & static initialisations
                                     85 ;--------------------------------------------------------
                                     86 	.area _HOME
                                     87 	.area _GSINIT
                                     88 	.area _GSFINAL
                                     89 	.area _GSINIT
                                     90 ;--------------------------------------------------------
                                     91 ; Home
                                     92 ;--------------------------------------------------------
                                     93 	.area _HOME
                                     94 	.area _HOME
                                     95 ;--------------------------------------------------------
                                     96 ; code
                                     97 ;--------------------------------------------------------
                                     98 	.area _CODE
                                     99 ;src/text_scroller.c:20: void scanline_isr(void) {
                                    100 ;	---------------------------------
                                    101 ; Function scanline_isr
                                    102 ; ---------------------------------
    00000000                        103 _scanline_isr::
                                    104 ;src/text_scroller.c:39: if (VCOUNTER == (SCROLL_POS_PIX_START - 8)) {
    00000000 DB 7E            [11]  105 	in	a, (_VCOUNTER)
    00000002 D6 6E            [ 7]  106 	sub	a, #0x6e
    00000004 20 18            [12]  107 	jr	NZ, 00108$
                                    108 ;src/text_scroller.c:40: while (VCOUNTER != SCROLL_POS_PIX_START);
    00000006                        109 00101$:
    00000006 DB 7E            [11]  110 	in	a, (_VCOUNTER)
    00000008 D6 76            [ 7]  111 	sub	a, #0x76
    0000000A 20 FA            [12]  112 	jr	NZ, 00101$
                                    113 ;src/text_scroller.c:41: VDP_CMD = -scroller_x; VDP_CMD = VDP_RSCX;
    0000000C 21r02r00         [10]  114 	ld	hl, #_scroller_x
    0000000F AF               [ 4]  115 	xor	a, a
    00000010 96               [ 7]  116 	sub	a, (hl)
    00000011 D3 BF            [11]  117 	out	(_VDP_CMD), a
    00000013 3E 88            [ 7]  118 	ld	a, #0x88
    00000015 D3 BF            [11]  119 	out	(_VDP_CMD), a
                                    120 ;src/text_scroller.c:42: while (VCOUNTER != SCROLL_POS_PIX_START + 8);
    00000017                        121 00104$:
    00000017 DB 7E            [11]  122 	in	a, (_VCOUNTER)
    00000019 D6 7E            [ 7]  123 	sub	a, #0x7e
    0000001B C8               [11]  124 	ret	Z
    0000001C 18 F9            [12]  125 	jr	00104$
    0000001E                        126 00108$:
                                    127 ;src/text_scroller.c:44: VDP_CMD = 0; VDP_CMD = VDP_RSCX;
    0000001E AF               [ 4]  128 	xor	a, a
    0000001F D3 BF            [11]  129 	out	(_VDP_CMD), a
    00000021 3E 88            [ 7]  130 	ld	a, #0x88
    00000023 D3 BF            [11]  131 	out	(_VDP_CMD), a
                                    132 ;src/text_scroller.c:47: }
    00000025 C9               [10]  133 	ret
    00000026                        134 _shake_tbl:
    00000026 00                     135 	.db #0x00	; 0
    00000027 01                     136 	.db #0x01	; 1
    00000028 01                     137 	.db #0x01	; 1
    00000029 01                     138 	.db #0x01	; 1
    0000002A 00                     139 	.db #0x00	; 0
    0000002B DF                     140 	.db #0xdf	; 223
    0000002C DF                     141 	.db #0xdf	; 223
    0000002D DF                     142 	.db #0xdf	; 223
    0000002E                        143 _scanline_offsets_tbl:
    0000002E 00                     144 	.db #0x00	; 0
    0000002F 01                     145 	.db #0x01	; 1
    00000030 02                     146 	.db #0x02	; 2
    00000031 03                     147 	.db #0x03	; 3
    00000032 03                     148 	.db #0x03	; 3
    00000033 02                     149 	.db #0x02	; 2
    00000034 01                     150 	.db #0x01	; 1
    00000035 00                     151 	.db #0x00	; 0
    00000036 00                     152 	.db #0x00	; 0
    00000037 01                     153 	.db #0x01	; 1
    00000038 02                     154 	.db #0x02	; 2
    00000039 03                     155 	.db #0x03	; 3
    0000003A 03                     156 	.db #0x03	; 3
    0000003B 02                     157 	.db #0x02	; 2
    0000003C 01                     158 	.db #0x01	; 1
    0000003D 00                     159 	.db #0x00	; 0
                                    160 ;src/text_scroller.c:58: void main(void) {
                                    161 ;	---------------------------------
                                    162 ; Function main
                                    163 ; ---------------------------------
    0000003E                        164 _main::
                                    165 ;../../../include/sms/sms.h:254: __WRITE_VDP_REG(VDP_R1, __READ_VDP_REG(VDP_R1) &= (~R1_DISP_ON));
    0000003E 3Ar00r00         [13]  166 	ld	a, (_shadow_VDP_R1+0)
    00000041 E6 BF            [ 7]  167 	and	a, #0xbf
    00000043 32r00r00         [13]  168 	ld	(_shadow_VDP_R1+0), a
    00000046 F3               [ 4]  169 	di
    00000047 3Ar00r00         [13]  170 	ld	a, (_shadow_VDP_R1+0)
    0000004A D3 BF            [11]  171 	out	(_VDP_CMD), a
    0000004C 3E 81            [ 7]  172 	ld	a, #0x81
    0000004E D3 BF            [11]  173 	out	(_VDP_CMD), a
    00000050 FB               [ 4]  174 	ei
                                    175 ;src/text_scroller.c:61: font_init();
    00000051 CDr00r00         [17]  176 	call	_font_init
                                    177 ;src/text_scroller.c:62: font_set(font_load(font_ibm));
    00000054 21r00r00         [10]  178 	ld	hl, #_font_ibm
    00000057 E5               [11]  179 	push	hl
    00000058 CDr00r00         [17]  180 	call	_font_load
    0000005B E3               [19]  181 	ex	(sp),hl
    0000005C CDr00r00         [17]  182 	call	_font_set
                                    183 ;src/text_scroller.c:64: fill_bkg_rect(0, 0, DEVICE_SCREEN_WIDTH, DEVICE_SCREEN_HEIGHT, '*' - ' ');
    0000005F 21 0A 00         [10]  184 	ld	hl, #0x000a
    00000062 E3               [19]  185 	ex	(sp),hl
    00000063 21 20 18         [10]  186 	ld	hl, #0x1820
    00000066 E5               [11]  187 	push	hl
    00000067 21 00 00         [10]  188 	ld	hl, #0x00
    0000006A E5               [11]  189 	push	hl
    0000006B CDr00r00         [17]  190 	call	_fill_rect_compat
                                    191 ;src/text_scroller.c:65: DISPLAY_ON;
    0000006E 3Ar00r00         [13]  192 	ld	a, (_shadow_VDP_R1+0)
    00000071 F6 40            [ 7]  193 	or	a, #0x40
    00000073 32r00r00         [13]  194 	ld	(_shadow_VDP_R1+0), a
    00000076 F3               [ 4]  195 	di
    00000077 3Ar00r00         [13]  196 	ld	a, (_shadow_VDP_R1+0)
    0000007A D3 BF            [11]  197 	out	(_VDP_CMD), a
    0000007C 3E 81            [ 7]  198 	ld	a, #0x81
    0000007E D3 BF            [11]  199 	out	(_VDP_CMD), a
    00000080 FB               [ 4]  200 	ei
                                    201 ;src/text_scroller.c:67: printf(" Scrolling %d chars", sizeof(scroller_text) - 1);
    00000081 21 68 01         [10]  202 	ld	hl, #0x0168
    00000084 E5               [11]  203 	push	hl
    00000085 21rBDr02         [10]  204 	ld	hl, #___str_0
    00000088 E5               [11]  205 	push	hl
    00000089 CDr00r00         [17]  206 	call	_printf
    0000008C F1               [10]  207 	pop	af
    0000008D F1               [10]  208 	pop	af
                                    209 ;src/text_scroller.c:74: }
    0000008E ED 57            [ 9]  210 	ld	a,i
    00000090 F3               [ 4]  211 	di
    00000091 F5               [11]  212 	push	af
                                    213 ;src/text_scroller.c:70: add_LCD(scanline_isr);
    00000092 21r00r00         [10]  214 	ld	hl, #_scanline_isr
    00000095 CDr00r00         [17]  215 	call	_add_LCD
    00000098 F1               [10]  216 	pop	af
    00000099 E2r9Dr00         [10]  217 	jp	PO, 00151$
    0000009C FB               [ 4]  218 	ei
    0000009D                        219 00151$:
                                    220 ;src/text_scroller.c:76: __WRITE_VDP_REG(VDP_R10, 0x07);
    0000009D FD 21r00r00      [14]  221 	ld	iy, #_shadow_VDP_R10
    000000A1 FD 36 00 07      [19]  222 	ld	0 (iy), #0x07
    000000A5 F3               [ 4]  223 	di
    000000A6 3E 07            [ 7]  224 	ld	a, #0x07
    000000A8 D3 BF            [11]  225 	out	(_VDP_CMD), a
    000000AA 3E 8A            [ 7]  226 	ld	a, #0x8a
    000000AC D3 BF            [11]  227 	out	(_VDP_CMD), a
    000000AE FB               [ 4]  228 	ei
                                    229 ;src/text_scroller.c:79: set_interrupts(VBL_IFLAG | LCD_IFLAG);
    000000AF 2E 03            [ 7]  230 	ld	l, #0x03
    000000B1 CDr00r00         [17]  231 	call	_set_interrupts
                                    232 ;src/text_scroller.c:81: HIDE_LEFT_COLUMN;    
    000000B4 3Ar00r00         [13]  233 	ld	a, (_shadow_VDP_R0+0)
    000000B7 F6 20            [ 7]  234 	or	a, #0x20
    000000B9 32r00r00         [13]  235 	ld	(_shadow_VDP_R0+0), a
    000000BC F3               [ 4]  236 	di
    000000BD 3Ar00r00         [13]  237 	ld	a, (_shadow_VDP_R0+0)
    000000C0 D3 BF            [11]  238 	out	(_VDP_CMD), a
    000000C2 3E 80            [ 7]  239 	ld	a, #0x80
    000000C4 D3 BF            [11]  240 	out	(_VDP_CMD), a
    000000C6 FB               [ 4]  241 	ei
                                    242 ;src/text_scroller.c:82: base = (uint8_t *)((uint16_t)get_bkg_xy_addr(0, SCROLL_POS) & (DEVICE_SCREEN_MAP_ENTRY_SIZE==1?0xffe0:0xffc0));
    000000C7 21 00 0F         [10]  243 	ld	hl, #0xf00
    000000CA E5               [11]  244 	push	hl
    000000CB CDr00r00         [17]  245 	call	_get_bkg_xy_addr
    000000CE 7D               [ 4]  246 	ld	a, l
    000000CF E6 C0            [ 7]  247 	and	a, #0xc0
    000000D1 6F               [ 4]  248 	ld	l, a
    000000D2 22r02r00         [16]  249 	ld	(_base), hl
                                    250 ;src/text_scroller.c:83: limit = base + (DEVICE_SCREEN_BUFFER_WIDTH * DEVICE_SCREEN_MAP_ENTRY_SIZE);
    000000D5 2Ar02r00         [16]  251 	ld	hl, (_base)
    000000D8 11 40 00         [10]  252 	ld	de, #0x0040
    000000DB 19               [11]  253 	add	hl, de
    000000DC 22r04r00         [16]  254 	ld	(_limit), hl
                                    255 ;src/text_scroller.c:85: scroller_vram_addr = base + ((DEVICE_SCREEN_X_OFFSET + DEVICE_SCREEN_WIDTH) * DEVICE_SCREEN_MAP_ENTRY_SIZE);
    000000DF 22r00r00         [16]  256 	ld	(_scroller_vram_addr), hl
                                    257 ;src/text_scroller.c:86: if (scroller_vram_addr >= limit) scroller_vram_addr = base;
    000000E2 21r04r00         [10]  258 	ld	hl, #_limit
    000000E5 3Ar00r00         [13]  259 	ld	a, (_scroller_vram_addr+0)
    000000E8 96               [ 7]  260 	sub	a, (hl)
    000000E9 23               [ 6]  261 	inc	hl
    000000EA 3Ar01r00         [13]  262 	ld	a, (_scroller_vram_addr+1)
    000000ED 9E               [ 7]  263 	sbc	a, (hl)
    000000EE 38 06            [12]  264 	jr	C, 00102$
    000000F0 2Ar02r00         [16]  265 	ld	hl, (_base)
    000000F3 22r00r00         [16]  266 	ld	(_scroller_vram_addr), hl
    000000F6                        267 00102$:
                                    268 ;src/text_scroller.c:88: set_vram_byte(scroller_vram_addr, *scroller_next_char - 0x20);
    000000F6 2Ar03r00         [16]  269 	ld	hl, (_scroller_next_char)
    000000F9 7E               [ 7]  270 	ld	a, (hl)
    000000FA C6 E0            [ 7]  271 	add	a, #0xe0
    000000FC F5               [11]  272 	push	af
    000000FD 33               [ 6]  273 	inc	sp
    000000FE 2Ar00r00         [16]  274 	ld	hl, (_scroller_vram_addr)
    00000101 E5               [11]  275 	push	hl
    00000102 CDr00r00         [17]  276 	call	_set_vram_byte
                                    277 ;src/text_scroller.c:90: while (1) {
    00000105                        278 00110$:
                                    279 ;src/text_scroller.c:91: scroller_x++;
    00000105 21r02r00         [10]  280 	ld	hl, #_scroller_x
    00000108 34               [11]  281 	inc	(hl)
                                    282 ;src/text_scroller.c:92: if ((scroller_x & 0x07) == 0) {
    00000109 3Ar02r00         [13]  283 	ld	a, (_scroller_x+0)
    0000010C E6 07            [ 7]  284 	and	a, #0x07
    0000010E 20 3F            [12]  285 	jr	NZ, 00108$
                                    286 ;src/text_scroller.c:94: scroller_next_char++;
    00000110 2Ar03r00         [16]  287 	ld	hl, (_scroller_next_char)
    00000113 23               [ 6]  288 	inc	hl
    00000114 22r03r00         [16]  289 	ld	(_scroller_next_char), hl
                                    290 ;src/text_scroller.c:95: if (*scroller_next_char == 0) scroller_next_char = scroller_text;
    00000117 2Ar03r00         [16]  291 	ld	hl, (_scroller_next_char)
    0000011A 7E               [ 7]  292 	ld	a, (hl)
    0000011B B7               [ 4]  293 	or	a, a
    0000011C 20 06            [12]  294 	jr	NZ, 00104$
    0000011E 21r54r01         [10]  295 	ld	hl, #_scroller_text
    00000121 22r03r00         [16]  296 	ld	(_scroller_next_char), hl
    00000124                        297 00104$:
                                    298 ;src/text_scroller.c:98: scroller_vram_addr += DEVICE_SCREEN_MAP_ENTRY_SIZE;
    00000124 2Ar00r00         [16]  299 	ld	hl, (_scroller_vram_addr)
    00000127 23               [ 6]  300 	inc	hl
    00000128 23               [ 6]  301 	inc	hl
    00000129 22r00r00         [16]  302 	ld	(_scroller_vram_addr), hl
                                    303 ;src/text_scroller.c:99: if (scroller_vram_addr >= limit) scroller_vram_addr = base;
    0000012C 21r04r00         [10]  304 	ld	hl, #_limit
    0000012F 3Ar00r00         [13]  305 	ld	a, (_scroller_vram_addr+0)
    00000132 96               [ 7]  306 	sub	a, (hl)
    00000133 23               [ 6]  307 	inc	hl
    00000134 3Ar01r00         [13]  308 	ld	a, (_scroller_vram_addr+1)
    00000137 9E               [ 7]  309 	sbc	a, (hl)
    00000138 38 06            [12]  310 	jr	C, 00106$
    0000013A 2Ar02r00         [16]  311 	ld	hl, (_base)
    0000013D 22r00r00         [16]  312 	ld	(_scroller_vram_addr), hl
    00000140                        313 00106$:
                                    314 ;src/text_scroller.c:102: set_vram_byte(scroller_vram_addr, *scroller_next_char - 0x20);
    00000140 2Ar03r00         [16]  315 	ld	hl, (_scroller_next_char)
    00000143 7E               [ 7]  316 	ld	a, (hl)
    00000144 C6 E0            [ 7]  317 	add	a, #0xe0
    00000146 F5               [11]  318 	push	af
    00000147 33               [ 6]  319 	inc	sp
    00000148 2Ar00r00         [16]  320 	ld	hl, (_scroller_vram_addr)
    0000014B E5               [11]  321 	push	hl
    0000014C CDr00r00         [17]  322 	call	_set_vram_byte
    0000014F                        323 00108$:
                                    324 ;src/text_scroller.c:104: vsync();        
    0000014F CDr00r00         [17]  325 	call	_vsync
                                    326 ;src/text_scroller.c:106: }
    00000152 18 B1            [12]  327 	jr	00110$
    00000154                        328 _scroller_text:
    00000154 54 68 69 73 20 69 73   329 	.ascii "This is a text scroller demo for GBDK-2020. You can use idea"
             20 61 20 74 65 78 74
             20 73 63 72 6F 6C 6C
             65 72 20 64 65 6D 6F
             20 66 6F 72 20 47 42
             44 4B 2D 32 30 32 30
             2E 20 59 6F 75 20 63
             61 6E 20 75 73 65 20
             69 64 65 61
    00000190 73 2C 20 74 68 61 74   330 	.ascii "s, that are shown in this demo, to make different parallax e"
             20 61 72 65 20 73 68
             6F 77 6E 20 69 6E 20
             74 68 69 73 20 64 65
             6D 6F 2C 20 74 6F 20
             6D 61 6B 65 20 64 69
             66 66 65 72 65 6E 74
             20 70 61 72 61 6C 6C
             61 78 20 65
    000001CC 66 66 65 63 74 73 2C   331 	.ascii "ffects, scrolling of tilemaps which are larger than 32x32 ti"
             20 73 63 72 6F 6C 6C
             69 6E 67 20 6F 66 20
             74 69 6C 65 6D 61 70
             73 20 77 68 69 63 68
             20 61 72 65 20 6C 61
             72 67 65 72 20 74 68
             61 6E 20 33 32 78 33
             32 20 74 69
    00000208 6C 65 73 20 61 6E 64   332 	.ascii "les and TEXT SCROLLERS, of course! Need to write something e"
             20 54 45 58 54 20 53
             43 52 4F 4C 4C 45 52
             53 2C 20 6F 66 20 63
             6F 75 72 73 65 21 20
             4E 65 65 64 20 74 6F
             20 77 72 69 74 65 20
             73 6F 6D 65 74 68 69
             6E 67 20 65
    00000244 6C 73 65 20 74 6F 20   333 	.ascii "lse to make this text longer than 256 characters. The quick "
             6D 61 6B 65 20 74 68
             69 73 20 74 65 78 74
             20 6C 6F 6E 67 65 72
             20 74 68 61 6E 20 32
             35 36 20 63 68 61 72
             61 63 74 65 72 73 2E
             20 54 68 65 20 71 75
             69 63 6B 20
    00000280 72 65 64 20 66 6F 78   334 	.ascii "red fox jumps over the lazy brown dog. 0123456789.          "
             20 6A 75 6D 70 73 20
             6F 76 65 72 20 74 68
             65 20 6C 61 7A 79 20
             62 72 6F 77 6E 20 64
             6F 67 2E 20 30 31 32
             33 34 35 36 37 38 39
             2E 20 20 20 20 20 20
             20 20 20 20
    000002BC 00                     335 	.db 0x00
    000002BD                        336 ___str_0:
    000002BD 20 53 63 72 6F 6C 6C   337 	.ascii " Scrolling %d chars"
             69 6E 67 20 25 64 20
             63 68 61 72 73
    000002D0 00                     338 	.db 0x00
                                    339 	.area _CODE
                                    340 	.area _INITIALIZER
    00000000                        341 __xinit__scanline_offsets:
    00000000r2Er00                  342 	.dw _scanline_offsets_tbl
    00000002                        343 __xinit__scroller_x:
    00000002 00                     344 	.db #0x00	; 0
    00000003                        345 __xinit__scroller_next_char:
    00000003r54r01                  346 	.dw _scroller_text
                                    347 	.area _CABS (ABS)
